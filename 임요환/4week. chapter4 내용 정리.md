# 역할, 책임, 협력
- 협력이라는 문맥이 객체의 행동 방식을 결정함 -> 협력의 품질을 올려야 함
- 객체들 간의 협력에 집중하라

## 협력
### 요청하고 응답하며 협력하는 사람들
- 협력은 한 사람이 다른 사람에게 요청할 때 시작됨
- 협력은 다수의 요청과 응답으로 구성되며 전체적으로 협력은 다수의 연쇄적인 요청과 응답의 흐름으로 구성됨 -> 협력의 네트워크가 구축됨

### 누가 파이를 훔쳤지?
- 이야기의 등장 객체들은 하트 잭의 재판이라는 동일한 목적을 달성하기 위해 협력함

### 재판 속의 협력
- 왕이 모자 장수로부터 증언을 듣는 과정
1. 누군가 왕에게 재판을 `요청`함(누군가 -> 왕)
2. 왕이 하얀 토끼에게 증인을 부를 것을 `요청`함(왕 -> 하얀 토끼)
3. 왕의 요청을 받은 토끼는 모자 장수에게 증인석으로 입장할 것을 `요청`함(토끼 -> 모자 장수)
4. 모자 장수는 증인석에 입장함으로써 토끼의 요청에 `응답`함(모자 장수 -> 토끼)
5. 모자장수의 입장은 왕이 토끼에게 요청했던 증인 호출에 대한 `응답`이기도 함(토끼 -> 왕)
6. 이제 왕은 모자 장수에게 증언할 것을 `요청`함(왕 -> 모자 장수)
7. 모자 장수는 자신이 알고 있는 내용을 증언함으로써 왕의 요청에 `응답`함(모자 장수 -> 왕)
- 요청과 응답은 협력에 참여하는 객체가 수행할 책임을 정의함

## 책임
- 어떤 객체가 어떤 요청에 대해 대답해 줄 수 있거나, 적절한 행동을 하라 의무가 있는 경우 해당 겍체가 책임을 가진다고 함
- 객체와 책임이 이리저리 부유하는 상황에서 성급하게 구현에 뛰어드는 것은 변경에 취약하고 다양한 협력에 참여할 수 없는 비자율적인 객체를 낳게 됨

### 책임의 분류
- 객체의 책임의 두가지 구성 요소
    - 무엇을 할 수 있는가(doing)
        - 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
        - 다른 객체의 행동을 시작시키는 것
        - 다른 객체의 활동을 제어하고 조절하는 것
    - 무엇을 알고 있는가(knowing)
        - 개인적인 정보에 관해 아는 것
        - 관련된 객체에 관해 아는 것
        - 자신이 유도하거나 계싼할 수 있는 것에 관해 아는 것
- 책임은 객체지향 설계의 품질을 결정하는 가장 중요한 요소
- 책임은 객체의 외부에 제공해 줄 수 있는 정보(knowing)와 외부에 제공해 줄 수 있는 서비스(doing)의 목록임
- 책임은 객체의 공용 인터페이스를 구성함

### 책임과 메시지
- 메시지 = 협력에 참여하는 두 객체 사이의 관계를 강조함(송신자 <-> 수신자)
- 메시지 전송(message-send) = 객체가 다른 객체에게 주어진 책임을 수행하도록 요청을 보내는 것
- 어떤 객체가 어떤 책임을 수행해야하고 어떤 객체로부터 메시지를 수신할 것인지 결정한 후 어떤 클래스가 필요하고 어떤 메서드를 포함해야 하는지를 결정하는 것이 적절함

## 역할
### 책임의 집합이 의미하는 것
- 역할 = 재사용 가능하고 유연한 객체지향 설계를 낳는 매우 중요한 구성요소

### 판사와 증인
- 판사라는 역할이 왕에서 여왕에게 위임되고 증인이라는 역할이 모자 장수, 요리사, 앨리스에게 위임되도 동일한 역할을 수행함

### 역할이 답이다
- 역할 = 협력 내에서 다른 객체로 대체할 수 있음을 나타내는 일종의 표식
- 동일한 역할을 수행할 수 있다는 것은 해당 겍채들이 협력 내에서 동일한 책임의 집합을 수행할 수 있다는 것을 의미함
- 동일한 역할을 수행하는 객체들은 동일한 메시지를 수신할 수 있어 동일한 책임을 수행할 수 있음
- 역할 = 단순성(simplicity), 유연성(flexibility), 재사용성(reusablility)응 뒷받침하는 핵심 개념

### 협력의 추상화
- 역할은 협력을 추상화할 수 있게 함 -> 동일한 구조의 협력을 다양한 문맥에서 재사용할 수 있게 함

### 대체 가능성
- 역할은 협력 안에서 구체적인 객체로 대체할 수 있는  추상적인 협력자이며 본질적으로 다른 객체에 의해 대체 가능함을 의미함
- 객체가 역할을 대체하기 위해서는 행동이 호환돼야 함
- 객체는 역할이 암시하는 책임보다 더 많은 책임을 가질 수 있으며 객체의 타입과 역할 사이에는 일반화/특수화 관계가 성립하는 것이 일반적임
- 역할의 대체 가능성은 행위 호환성을 의미하고, 행위 호환성은 동일한 책임의 수행을 의미함

## 객체의 모양을 결정하는 협력
### 흔한 오류
- 객체가 존재하는 이유는 데이터를 저장하기 위해서가 아니라 행위를 수행하며 협력에 참여하기 위해서임
- 객체지향은 클래스와 클래스 간의 관계를 표현하는 정적인 클래스가 아니라 협력에 참여하는 동적인 객체임

### 협력을 따라 흐르는 객체의 책임
- 올바른 객체를 설계하기 위해서는 견고하고 깔끔한 협력을 설계해야 함 -> 설계에 참여하는 객체들이 주고받을 요청과 응답의 흐름을 결정한다는 것
- 객체의 책임은 외부에 제공하게 될 행동이 됨
- 클래스와 데이터는 협력과 책임의 집합이 결정된 후에야 등장 가능
- 협력 -> 협력을 위한 책임 -> 책임 할의 과정이 얼마나 합리적이고 적절하게 수행했는지가 객체지향 설계의 품질을 결정함
- 객체를 충분히 협력적으로 만든 후에 협력이라는 문맥 안에서 객체를 충분히 자율적으로 만들어야 함

## 객체지향 설계 기법
- 책임-주도 설계(Responsibility-Driven Design)
    - 협력에 필요한 책임들을 식별하고 적합한 객체에게 책임을 할당하는 방식
- 디자인 패턴(Design Pattern)
    - 반복적으로 사용하는 해결 방법을 정의해 놓은 설계 템플릿의 모음
    - 특정 문제를 해결하기 위해 이미 식별해 놓은 역할, 책임, 협력의 모음
- 테스트-주도 개발(Test-Driven Development)
    - 테스트를 먼저 작성하고 테스트를 통과하는 구체적인 코드르르 추가하여 애플리케이션을 완성해가는 방식
    - 테스트는 별도의 보너스이며 구체적인 코드를 작성해나가면서 역할, 책임, 협력을 식별하고 식별된 역할, 책임, 협력이 적합한지를 피드백받는 것

### 책임-주도 설계
- 시스템의 기능은 더 작은 규모의 책임으로 분할되고 각 책임은 책임을 수행할 적절한 객체에게 할당됨
- 객체가 책임을 수행하며 스스로 처리할 수 없을 시 적절한 객체를 찾아 작업을 요청함 -> 다른 객체의 책임으로 변환 -> 협력 관계가 생성됨
- 시스템 책임 파악 -> 더 작은 책임으로 분할 -> 책임을 수행할 적절한 객체 또는 역할을 찾아 책임 할당 -> 책임 수행 중 다른 객체의 도움이 필요할 경우 적절한 객체 또는 역할을 찾음 -> 해당 객체 또는 역할에게 책임을 할당함으로써 협력

### 디자인 패턴
- 책임-주도 설계의 결과를 표현함
- COMPOSITE 패턴
    - 메시지 수신자가 부분인지 전체인지에 상관 없이 동일한 메시지를 이용해 동일한 방식으로 대상과 상호작용하고 싶을 때 사용할 수 있는 패턴
    - Component는 클라이언트와 협력할 수 있는 공용 인터페이스를 정의하는 역할을 수행
    - Leaf 역할은 공용 인터페이스에 대한 오퍼레이션 호출에 응답할 수 있는 기본적인 행위를 구현
    - Composite은 외부로부터 부분에 대한 세부 사항을 감추고 포함된 부분을 하나의 단위로 행동하는 역할
    - Client는 Component에게 메시지를 요청함으로써 협력하는 임의의 역할
    - Component의 역할은 다른 Component를 추가하거나, 제거하거나, 포함된 Component를 반환해야하는 책임을 가짐
    - Composite 패턴은 부분과 전체가 투명하고 동일한 인터페이스를 제공해야 한다는 제약하에서 식별된 역할, 책임, 협력을 제공하는 설계임
- 공통으로 사용할 수 있는 역할, 책임, 협력의 템플릿임

### 테스트-주도 개발
- 실패하는 테스트를 작성하고, 테스트를 통과하는 가장 간단한 코드를 작성한 후 리팩터링을 통해 중복을 제거하는 것
- 작동하는 깔끔한 코드를 얻을 수 있음
- 테스트를 작성하는 것이 아니라 책임을 수행할 객체가 기대하는 객체의 역할이 메시지를 수신할 때 어떤 결과를 반환하고 어떤 객체와 협력할 것인지에 대한 기대를 코드로 작성하는 것임
- 객체지향에 대한 깊이 있는 지식을 요구하며 책임-주도 설계의 기본 개념과 다양한 원칙과 프랙티스, 패턴을 종합적으로 이해해야 좋은 TDD를 할 수 있음